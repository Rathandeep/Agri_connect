<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - KrishiMandi</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

    <style>
        /* ==========================================================================
           1. EMBEDDED GLOBAL STYLES (Derived from style.css)
           ========================================================================== */
        :root {
            --primary-color: #2ECC71;
            --primary-hover: #27ae60;
            --secondary-color: #16A085;
            --heading-color: #2c3e50;
            --text-color: #34495e;
            --light-text: #7f8c8d;
            --bg-color: #ffffff;
            --alt-bg-color: #f4f7f6;
            --border-color: #e0e0e0;
            --white-color: #ffffff;
            --danger-color: #e74c3c;
            --primary-gradient: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --card-shadow-hover: 0 10px 30px rgba(46, 204, 113, 0.15);
            --font-family: 'Inter', sans-serif;
            --transition-speed: 0.3s;
            --border-radius: 12px;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font-family);
            color: var(--text-color);
            background-color: var(--alt-bg-color);
            line-height: 1.7;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .app-section { padding: 80px 0; }
        
        /* --- Header & Footer --- */
        .app-header { background-color: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); padding: 1rem 0; border-bottom: 1px solid rgba(0, 0, 0, 0.05); position: sticky; top: 0; width: 100%; z-index: 1000; }
        .app-header .container { display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 12px; text-decoration: none; }
        .logo h1 { font-size: 1.6rem; font-weight: 700; color: var(--heading-color); }
        .main-nav { display: flex; gap: 2rem; align-items: center; }
        .main-nav a { text-decoration: none; color: var(--text-color); font-weight: 600; transition: color var(--transition-speed) ease; position: relative; padding: 8px 4px; }
        .main-nav a::after { content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 3px; background-image: var(--primary-gradient); transition: width 0.4s ease; border-radius: 2px; }
        .main-nav a:hover, .main-nav a.active { color: var(--heading-color); }
        .main-nav a:hover::after, .main-nav a.active::after { width: 100%; }
        #profile-nav-pic { width: 42px; height: 42px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; object-fit: cover; transition: all var(--transition-speed) ease; }
        .app-footer { padding: 60px 0; background-color: var(--heading-color); color: rgba(255, 255, 255, 0.7); text-align: center; }
        .footer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px; padding-bottom: 40px; text-align: left; }
        .footer-col h5 { color: var(--white-color); margin-bottom: 1rem; }
        .footer-col ul { list-style: none; }
        .footer-col ul li { margin-bottom: 0.75rem; }
        .footer-col a { color: rgba(255, 255, 255, 0.7); text-decoration: none; transition: color var(--transition-speed); }
        .footer-col a:hover { color: var(--primary-color); }
        .social-icons { display: flex; gap: 1rem; margin-top: 1rem; }
        .social-icons a { display: inline-flex; justify-content: center; align-items: center; width: 40px; height: 40px; border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 50%; }
        .footer-bottom { padding-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.1); }

        /* --- Reusable Components --- */
        .card { background: var(--bg-color); border-radius: var(--border-radius); padding: 2rem; box-shadow: var(--card-shadow); }
        .btn { display: inline-block; padding: 12px 28px; border-radius: 50px; border: 2px solid transparent; font-size: 0.95rem; font-weight: 600; cursor: pointer; text-decoration: none; text-align: center; transition: all var(--transition-speed) ease; }
        .btn-primary { background-image: var(--primary-gradient); color: var(--white-color); border: none; }
        .btn-primary:hover { transform: translateY(-4px); box-shadow: 0 8px 15px rgba(46, 204, 113, 0.3); }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1rem; font-family: var(--font-family); transition: all 0.2s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.2); }
        .form-group input:disabled { background-color: var(--alt-bg-color); cursor: not-allowed; }

        /* ==========================================================================
           2. PAGE-SPECIFIC STYLES FOR PROFILE
           ========================================================================== */
        .profile-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: var(--bg-color);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
        }
        .profile-picture-wrapper {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 1rem;
            cursor: pointer;
        }
        .profile-picture {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--white-color);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .profile-picture-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: rgba(0,0,0,0.5);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity var(--transition-speed);
        }
        .profile-picture-wrapper:hover .profile-picture-overlay {
            opacity: 1;
        }
        .profile-name { font-size: 2rem; font-weight: 700; color: var(--heading-color); margin: 0; }
        .profile-email { color: var(--light-text); }

        .profile-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            align-items: flex-start;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        .card-header h4 {
            font-size: 1.3rem;
            color: var(--heading-color);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .btn-edit {
            font-size: 0.9rem;
            padding: 6px 14px;
            border-radius: 6px;
            background: var(--alt-bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            cursor: pointer;
        }

        /* Activity Feed */
        .activity-feed {
            list-style: none;
            max-height: 400px;
            overflow-y: auto;
        }
        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
        }
        .activity-item:last-child { border-bottom: none; }
        .activity-icon {
            flex-shrink: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--alt-bg-color);
            color: var(--text-color);
        }
        .activity-text { font-size: 0.95rem; }
        .activity-timestamp { font-size: 0.8rem; color: var(--light-text); }

        /* --- Modals --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1010; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.95); background: white; padding: 2rem; border-radius: var(--border-radius); z-index: 1011; width: 90%; max-width: 700px; opacity: 0; pointer-events: none; transition: all 0.3s ease; }
        .modal.active { transform: translate(-50%, -50%) scale(1); opacity: 1; pointer-events: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .modal-header h4 { font-size: 1.5rem; color: var(--heading-color); margin:0; }
        .close-btn { font-size: 2rem; background: none; border: none; cursor: pointer; color: var(--light-text); line-height: 1; }
        #ai-plan-response { max-height: 60vh; overflow-y: auto; padding-right: 1rem; }
        #ai-plan-response h5 { color: var(--secondary-color); margin-top: 1rem; margin-bottom: 0.5rem; font-size: 1.2rem; }
        #ai-plan-response ul { list-style-position: inside; padding-left: 0.5rem; }
        #ai-plan-response p { margin-bottom: 1rem; }

        @media (max-width: 900px) {
            .profile-layout { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) { .main-nav { display: none; } }
    </style>
</head>
<body>

    <header class="app-header">
        <div class="container">
            <a href="index.html" class="logo">
                 <svg width="32" height="32" viewBox="0 0 24 24"><path d="M21.58 9.55c-1.84-3.53-5.02-6.11-8.8-6.53-2.2-.25-4.44.2-6.39 1.28-1.95 1.08-3.51 2.76-4.48 4.79-.31.65-.21 1.41.24 1.95.45.54 1.2.75 1.86.54.66-.21 1.11-.82.9-1.48.79-1.67 2.06-3.03 3.65-3.87 1.59-.84 3.42-1.16 5.25-.9 3.03.43 5.61 2.5 6.96 5.11.39.75 1.22 1.13 2 .85.78-.28 1.25-1.08.97-1.85zM2.42 14.45c1.84 3.53 5.02 6.11 8.8 6.53 2.2.25 4.44-.2 6.39-1.28 1.95-1.08 3.51 2.76 4.48-4.79.31-.65-.21 1.41-.24-1.95-.45-.54-1.2-.75-1.86-.54-.66-.21-1.11.82-.9 1.48-.79 1.67-2.06 3.03-3.65 3.87-1.59-.84-3.42-1.16-5.25-.9-3.03-.43-5.61-2.5-6.96-5.11-.39-.75-1.22-1.13-2-.85-.78-.28-1.25-1.08-.97 1.85z" fill="#2ECC71"></path></svg>
                <h1 data-translate-key="app_title">KrishiMandi</h1>
            </a>
            <nav class="main-nav">
                <a href="index.html" data-translate-key="nav_home">Home</a>
                <a href="prices.html" data-translate-key="nav_prices">Prices</a>
                <a href="buy.html" data-translate-key="nav_marketplace">Marketplace</a>
                <a href="farmlog.html" data-translate-key="nav_farmlog">Farm Log</a>
                <a href="tools.html" data-translate-key="nav_tools">AI Tools</a>
                <a href="knowledge-hub.html" data-translate-key="nav_knowledge">Knowledge Hub</a>
                <a href="community.html" data-translate-key="nav_community">Community</a>
                <a href="contact.html" data-translate-key="nav_contact">Contact</a>
                <img src="https://placehold.co/40x40/E8F5E9/2c3e50?text=S" alt="Profile" id="profile-nav-pic" title="View Profile">
            </nav>
        </div>
    </header>

    <main>
        <section class="app-section">
            <div class="container">
                <div class="profile-header">
                    <div class="profile-picture-wrapper">
                        <img src="https://placehold.co/120x120/E8F5E9/2ECC71?text=U" alt="Profile Picture" class="profile-picture" id="profile-pic">
                        <div class="profile-picture-overlay">
                            <i data-feather="camera"></i>
                            <span style="font-size: 0.8rem;" data-translate-key="profile_change_pic">Change</span>
                        </div>
                        <input type="file" id="profile-pic-input" style="display: none;" accept="image/*">
                    </div>
                    <h2 class="profile-name" id="profile-display-name">User Name</h2>
                    <p class="profile-email" id="profile-display-email">user@email.com</p>
                </div>

                <div class="profile-layout">
                    <div class="profile-forms">
                        <form id="profile-form">
                            <div class="card">
                                <div class="card-header">
                                    <h4 data-translate-key="profile_basic_details_title"><i data-feather="user"></i>Basic Details</h4>
                                    <button type="button" id="edit-details-btn" class="btn-edit" data-translate-key="profile_edit_btn">Edit</button>
                                </div>
                                <div class="form-group">
                                    <label for="full-name" data-translate-key="profile_fullname_label">Full Name</label>
                                    <input type="text" id="full-name" data-translate-key="profile_fullname_placeholder" placeholder="e.g., Ramesh Kumar" disabled>
                                </div>
                                <div class="grid-2">
                                    <div class="form-group">
                                        <label for="mobile" data-translate-key="profile_mobile_label">Mobile Number</label>
                                        <input type="tel" id="mobile" data-translate-key="profile_mobile_placeholder" placeholder="e.g., 9876543210" disabled>
                                    </div>
                                    <div class="form-group">
                                        <label for="language" data-translate-key="profile_language_label">Language Preference</label>
                                        <select id="language">
                                            <option value="en">English</option>
                                            <option value="kn">Kannada (ಕನ್ನಡ)</option>
                                            <option value="hi">Hindi (हिंदी)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="address" data-translate-key="profile_address_label">Address / Village</label>
                                    <input type="text" id="address" data-translate-key="profile_address_placeholder" placeholder="Enter your village or full address">
                                </div>
                                <div class="grid-2">
                                    <div class="form-group">
                                        <label for="district" data-translate-key="profile_district_label">District</label>
                                        <input type="text" id="district" data-translate-key="profile_district_placeholder" placeholder="e.g., Ramnagara">
                                    </div>
                                    <div class="form-group">
                                        <label for="state" data-translate-key="profile_state_label">State</label>
                                        <input type="text" id="state" data-translate-key="profile_state_placeholder" placeholder="e.g., Karnataka">
                                    </div>
                                </div>
                            </div>

                            <div class="card" style="margin-top: 2rem;">
                                <div class="card-header">
                                    <h4 data-translate-key="profile_farming_info_title"><i data-feather="sunrise"></i>Farming Information</h4>
                                </div>
                                <div class="form-group">
                                    <label for="crops" data-translate-key="profile_main_crop_label">Main Crop(s) Grown</label>
                                    <input type="text" id="crops" data-translate-key="profile_main_crop_placeholder" placeholder="e.g., Rice, Ragi, Sugarcane">
                                </div>
                                <div class="grid-2">
                                     <div class="form-group">
                                        <label for="land-size" data-translate-key="profile_land_size_label">Land Size (in acres)</label>
                                        <input type="number" id="land-size" data-translate-key="profile_land_size_placeholder" placeholder="e.g., 5">
                                    </div>
                                    <div class="form-group">
                                        <label for="irrigation" data-translate-key="profile_irrigation_label">Irrigation Type</label>
                                        <select id="irrigation">
                                            <option value="rainfed">Rainfed</option>
                                            <option value="borewell">Borewell / Tube Well</option>
                                            <option value="canal">Canal</option>
                                            <option value="drip">Drip Irrigation</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="yield-history" data-translate-key="profile_last_yield_label">Last Season's Yield</label>
                                    <select id="yield-history">
                                        <option value="Successful / Profitable" data-translate-key="profile_yield_good">Successful / Profitable</option>
                                        <option value="Break-even / No Loss" data-translate-key="profile_yield_avg">Break-even / No Loss</option>
                                        <option value="Failure / Loss" data-translate-key="profile_yield_bad">Failure / Loss</option>
                                    </select>
                                </div>
                                 <div class="form-group">
                                    <label for="loan-status" data-translate-key="profile_loan_label">Do you have an active agricultural loan?</label>
                                    <select id="loan-status">
                                        <option value="no" data-translate-key="profile_loan_no">No</option>
                                        <option value="yes" data-translate-key="profile_loan_yes">Yes</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 2rem;" data-translate-key="profile_save_btn">Save Profile</button>
                        </form>
                    </div>

                    <div class="profile-dashboard">
                        <div class="card">
                            <div class="card-header">
                                <h4 data-translate-key="profile_ai_plan_title"><i data-feather="cpu"></i>AI Farming Plan</h4>
                            </div>
                            <p data-translate-key="profile_ai_plan_desc">Get a personalized farming plan for your specific crop and location, generated by our AI agronomist.</p>
                           <a href="planner.html" class="btn btn-primary" style="width: 100%; display: inline-flex; align-items: center; justify-content: center; text-decoration: none;">
  <i data-feather="sparkles" style="vertical-align: middle; margin-right: 8px;"></i> 
  <span data-translate-key="profile_ai_plan_btn">Generate My Plan</span>
</a>

                        </div>
                        
                        <div class="card" style="margin-top: 2rem;">
                            <div class="card-header">
                                <h4 data-translate-key="profile_activity_title"><i data-feather="list"></i>My Recent Activity</h4>
                            </div>
                            <ul class="activity-feed" id="activity-feed">
                                </ul>
                        </div>
                        
                        
                        <script>
                        document.addEventListener('DOMContentLoaded', () => {
                            
                            // Function to display cart items in the activity feed
                            function displayCartActivity() {
                                const activityFeed = document.getElementById('activity-feed');
                                if (!activityFeed) return; // Exit if the element doesn't exist
                        
                                // --- Helper functions (copied from your cart.html) ---
                                const getCart = () => JSON.parse(localStorage.getItem('agriConnectCart')) || [];
                                const formatCurrency = (amount) => `₹${amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                                
                                const cart = getCart();
                        
                                // --- Logic to render the cart items ---
                                if (cart.length === 0) {
                                    // If the cart is empty, show a message
                                    activityFeed.innerHTML = `
                                        <li>
                                            <div class="activity-icon">
                                                <i data-feather="info"></i>
                                            </div>
                                            <div class="activity-details">
                                                <p>No recent cart activity.</p>
                                                <small>Your cart is currently empty.</small>
                                            </div>
                                        </li>
                                    `;
                                } else {
                                    // If there are items, clear the list and build it
                                    activityFeed.innerHTML = ''; // Clear previous content
                                    
                                    cart.forEach(item => {
                                        const itemTotal = item.price * item.quantity;
                                        const listItemHTML = `
                                            <li>
                                                <div class="activity-icon">
                                                    <i data-feather="shopping-cart"></i>
                                                </div>
                                                <div class="activity-details">
                                                    <p><strong>In Your Cart:</strong> ${item.name}</p>
                                                    <small>Quantity: ${item.quantity} | Total: ${formatCurrency(itemTotal)}</small>
                                                </div>
                                            </li>
                                        `;
                                        activityFeed.innerHTML += listItemHTML;
                                    });
                                }
                                
                                // IMPORTANT: Refresh Feather Icons after adding new elements
                                feather.replace();
                            }
                        
                            // Run the function when the page loads
                            displayCartActivity();
                        
                            // Make sure to also call feather.replace() for other icons on your page
                            feather.replace(); 
                        });
                        </script>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <div id="ai-plan-modal-overlay" class="modal-overlay"></div>
    <div id="ai-plan-modal" class="modal">
        <div class="modal-header">
            <h4 data-translate-key="profile_ai_plan_modal_title">Your Personalized Farming Plan</h4>
            <button class="close-btn" data-modal-close>&times;</button>
        </div>
        <div class="modal-body" id="ai-plan-response">
            </div>
    </div>

    <div id="chatbot-container"></div>
    
    <footer class="app-footer">
        </footer>

    <script type="module">
        // --- Shared utility for showing toast notifications ---
        function showToast(message, type = 'success') { /* ... Toast function ... */ }

        document.addEventListener('DOMContentLoaded', () => {
            feather.replace();
            const GEMINI_API_KEY = "AIzaSyC_DFnBZD2FqGo8Xn1QjIl3ses0M-JO3I";
            
            const profileApp = {
                // ... (The full, extensive profile app logic will go here)
                // This will include:
                // 1. Language switcher with translation dictionary.
                // 2. Full profile save/load to localStorage.
                // 3. Profile picture uploader (Base64).
                // 4. Activity feed generator.
                // 5. AI Farming Plan generator.
                // 6. All event listeners.
            };
            
            // For brevity in this example, a simplified placeholder is used.
            // The final product would contain the full 500+ lines of JS logic.
             document.getElementById('edit-details-btn').addEventListener('click', () => {
                const nameInput = document.getElementById('full-name');
                nameInput.disabled = !nameInput.disabled;
                document.getElementById('mobile').disabled = !document.getElementById('mobile').disabled;
            });
            document.getElementById('profile-form').addEventListener('submit', (e) => {
                e.preventDefault();
                alert('Profile saved! (This is a demo)');
            });
             document.getElementById('generate-ai-plan-btn').addEventListener('click', () => {
                alert('AI Plan generation coming soon!');
            });
             document.getElementById('activity-feed').innerHTML = `<li class="activity-item"><div class="activity-icon"><i data-feather="shopping-cart"></i></div><div><p class="activity-text">You added <strong>IFFCO Urea</strong> to your cart.</p><p class="activity-timestamp">2 hours ago</p></div></li><li class="activity-item"><div class="activity-icon"><i data-feather="file-text"></i></div><div><p class="activity-text">You logged a new record for your <strong>Wheat</strong> crop.</p><p class="activity-timestamp">1 day ago</p></div></li>`;
             feather.replace();

        });
    </script>
</body>
</html>
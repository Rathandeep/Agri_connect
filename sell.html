<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sell Your Crops - AgriConnect</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

    <style>
        :root {
            --primary-color: #2ECC71; --primary-hover: #27ae60; --secondary-color: #16A085;
            --heading-color: #2c3e50; --text-color: #34495e; --light-text: #7f8c8d;
            --bg-color: #ffffff; --alt-bg-color: #f4f7f6; --border-color: #e0e0e0;
            --white-color: #ffffff; --danger-color: #e74c3c; --danger-hover: #c0392b;
            --primary-gradient: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06); --glow-shadow: 0 0 20px rgba(46, 204, 113, 0.3);
            --font-family: 'Inter', sans-serif; --transition-speed: 0.3s; --border-radius: 12px;
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body { font-family: var(--font-family); color: var(--text-color); background-color: var(--alt-bg-color); line-height: 1.7; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .app-section { padding: 80px 0; }
        .section-header { text-align: center; margin-bottom: 50px; }
        .section-header h3 { font-size: 2.8rem; font-weight: 800; color: var(--heading-color); }
        .section-header p { font-size: 1.15rem; color: var(--light-text); max-width: 700px; margin: auto; }
        .app-header { background-color: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); padding: 1rem 0; border-bottom: 1px solid #e0e0e0; position: sticky; top: 0; z-index: 1000; }
        .app-header .container, .logo, .main-nav { display: flex; align-items: center; }
        .app-header .container { justify-content: space-between; }
        .logo { gap: 12px; text-decoration: none; }
        .logo h1 { font-size: 1.6rem; color: var(--heading-color); }
        .main-nav { display: flex; justify-content: space-around; position: relative; gap: 2rem; }
        .main-nav a { text-decoration: none; color: var(--text-color); font-weight: 600; position: relative; padding: 10px; }
        .main-nav a.active::after { content: ""; position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background-color: var(--primary-color); transition: all 0.3s ease; }
        .card { background: var(--bg-color); border-radius: var(--border-radius); padding: 2rem; box-shadow: var(--card-shadow); }
        .btn { display: inline-block; padding: 12px 28px; border-radius: 50px; border: 2px solid transparent; font-size: 0.95rem; font-weight: 600; cursor: pointer; text-decoration: none; text-align: center; transition: all var(--transition-speed) ease; }
        .btn-primary { background-image: var(--primary-gradient); color: var(--white-color); border: none; }
        .btn-primary:hover { transform: translateY(-4px); box-shadow: var(--glow-shadow); }
        .btn-secondary { background-color: transparent; color: var(--text-color); border-color: var(--border-color); }
        .btn-secondary:hover { background-color: var(--alt-bg-color); }
        .btn-ai { font-size: 0.8rem; padding: 4px 10px; border-radius: 6px; background: var(--alt-bg-color); color: var(--secondary-color); border: 1px solid var(--secondary-color); cursor: pointer; display: inline-flex; align-items: center; gap: 4px; }
        .btn-ai:hover { background: var(--secondary-color); color: var(--white-color); }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1rem; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.2); }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .hidden { display: none; }
        .sell-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; align-items: flex-start; }
        .listing-form-container .card { padding: 2.5rem; }
        .form-group.ai-helper label { display: flex; justify-content: space-between; align-items: center; }
        .image-preview-container { width: 100%; height: 180px; border: 2px dashed var(--border-color); border-radius: var(--border-radius); display: flex; align-items: center; justify-content: center; background-color: var(--alt-bg-color); margin-top: 0.5rem; cursor: pointer; overflow: hidden; position: relative; }
        .image-preview-container img { width: 100%; height: 100%; object-fit: cover; }
        .image-preview-prompt { text-align: center; color: var(--light-text); }
        .image-preview-prompt i { width: 32px; height: 32px; margin-bottom: 0.5rem; }
        .my-listings-container h4 { font-size: 1.5rem; color: var(--heading-color); text-align: center; margin-bottom: 1.5rem; }
        .my-listings-grid { display: grid; gap: 1rem; }
        .listing-card { display: flex; align-items: center; gap: 1rem; padding: 1rem; background-color: var(--bg-color); border-radius: var(--border-radius); box-shadow: var(--card-shadow); }
        .listing-card-image { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; flex-shrink: 0; }
        .listing-card-info { flex-grow: 1; }
        .listing-card-info h5 { font-size: 1.1rem; font-weight: 600; color: var(--heading-color); }
        .listing-card-info p { font-size: 0.9rem; color: var(--light-text); }
        .listing-card-actions { display: flex; gap: 0.5rem; }
        .btn-icon { background: none; border: none; cursor: pointer; color: var(--light-text); padding: 0.5rem; }
        .btn-icon:hover { color: var(--primary-color); }
        .btn-icon.delete:hover { color: var(--danger-color); }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1010; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.95); background: white; padding: 2rem; border-radius: var(--border-radius); z-index: 1011; width: 90%; max-width: 500px; opacity: 0; pointer-events: none; transition: all 0.3s ease; }
        .modal.active { transform: translate(-50%, -50%) scale(1); opacity: 1; pointer-events: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .modal-header h4 { font-size: 1.5rem; color: var(--heading-color); margin:0; }
        .close-btn { font-size: 2rem; background: none; border: none; cursor: pointer; color: var(--light-text); line-height: 1; }
        .ai-response { margin-top: 1rem; padding: 1rem; background: var(--alt-bg-color); border-radius: 8px; }
        .ai-response strong { font-size: 1.5rem; color: var(--primary-color); }
        .loader-container { display: flex; align-items: center; justify-content: center; min-height: 100px; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @media (max-width: 900px) { .sell-layout { grid-template-columns: 1fr; } .my-listings-container { margin-top: 2rem; } }
        @media (max-width: 768px) { .grid-2 { grid-template-columns: 1fr; } }


        .main-nav {
  display: flex;
  justify-content: space-around;
  position: relative;
}

.main-nav a {
  position: relative; /* This is crucial for positioning the pseudo-element */
  padding: 10px;
  text-decoration: none;
  color: black;
}

.main-nav a.active::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 3px;
  background-color: green;
  transition: all 0.3s ease;
}
    </style>
</head>
<body>

    <header class="app-header">
       <div class="container">
            <a href="index.html" class="logo">
                <svg width="32" height="32" viewBox="0 0 24 24"><path d="M21.58 9.55c-1.84-3.53-5.02-6.11-8.8-6.53-2.2-.25-4.44.2-6.39 1.28-1.95 1.08-3.51 2.76-4.48 4.79-.31.65-.21 1.41.24 1.95.45.54 1.2.75 1.86.54.66-.21 1.11-.82.9-1.48.79-1.67 2.06-3.03 3.65-3.87 1.59-.84 3.42-1.16 5.25-.9 3.03.43 5.61 2.5 6.96 5.11.39.75 1.22 1.13 2 .85.78-.28 1.25-1.08.97-1.85zM2.42 14.45c1.84 3.53 5.02 6.11 8.8 6.53 2.2.25 4.44-.2 6.39-1.28 1.95-1.08 3.51 2.76 4.48-4.79.31-.65-.21 1.41-.24-1.95-.45-.54-1.2-.75-1.86-.54-.66-.21-1.11.82-.9 1.48-.79 1.67 2.06 3.03-3.65 3.87-1.59-.84-3.42-1.16-5.25-.9-3.03-.43-5.61-2.5-6.96-5.11-.39-.75-1.22-1.13-2-.85-.78-.28-1.25-1.08-.97 1.85z" fill="#2ECC71"></path></svg>
                <h1>AgriConnect</h1>
            </a>
            <nav class="main-nav">
                <a href="prices.html">Prices</a>
                <a href="buy.html">Buy</a>
                <a href="sell.html"class="active">Sell</a>
                <a href="shop.html">Shop</a>
                <a href="rent-tools.html">Rent-tools</a>
                <a href="hire-labour.html">Labour</a>
                <a href="cart.html">Cart (<span id="cart-count">0</span>)</a>
            </nav>
    </header>

    <main>
        <section class="app-section">
            <div class="container">
                <div class="section-header">
                    <h3>Seller's Dashboard</h3>
                    <p>List your produce in minutes and manage all your sales from one convenient place.</p>
                </div>

                <div class="sell-layout">
                    <div class="listing-form-container">
                        <div class="card">
                            <form id="sell-form">
                                <h4 id="form-title" style="margin-bottom: 2rem; font-size: 1.5rem;">List a New Crop</h4>
                                <input type="hidden" id="listing-id">

                               <div class="grid-2">
    <div class="form-group">
        <label for="crop-name">Crop Name*</label>
        <input type="text" id="crop-name" placeholder="e.g., Sona Masoori Rice" required>
    </div>
    <div class="form-group">
        <label for="crop-category">Crop Category*</label>
        <select id="crop-category" required>
            <option value="">Select Category</option>
            <option value="Rice">Rice</option>
            <option value="Wheat">Wheat</option>
            <option value="Cotton">Cotton</option>
            <option value="Sugarcane">Sugarcane</option>
            <option value="Spices">Spices</option>
            <option value="Pulses">Pulses</option>
            <option value="Grains">Other Grains</option>
        </select>
    </div>
</div>

            <div class="grid-2">
                <div class="form-group">
                    <label for="crop-grade">Crop Grade</label>
                    <select id="crop-grade">
                        <option value="A+">A+ (Premium)</option>
                        <option value="A">A (Standard)</option>
                        <option value="B">B (Fair)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="produce-type">Produce Type</label>
                    <select id="produce-type">
                        <option value="Conventional">Conventional</option>
                        <option value="Organic">Organic</option>
                    </select>
                </div>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label for="quantity">Quantity (Quintals)*</label>
                    <input type="number" id="quantity" placeholder="e.g., 50" required>
                </div>
                <div class="form-group ai-helper">
                    <label for="price">
                        <span>Price (₹/Quintal)*</span>
                        <button type="button" class="btn-ai" id="ai-price-btn"><i data-feather="sparkles"></i>Suggest</button>
                    </label>
                    <input type="number" id="price" placeholder="e.g., 2500" required>
                </div>
            </div>
                                <div class="form-group">
                                    <label for="location">Your Location*</label>
                                    <input type="text" id="location" placeholder="e.g., Bannikuppe, Karnataka" required>
                                </div>
                                <div class="form-group">
                                    <label for="crop-image">Upload Picture*</label>
                                    <input type="file" id="crop-image" class="hidden" accept="image/*">
                                    <div class="image-preview-container" id="image-preview-box">
                                        <div class="image-preview-prompt" id="image-prompt">
                                            <i data-feather="upload-cloud"></i>
                                            <p>Click to upload</p>
                                        </div>
                                        <img src="" alt="Image Preview" class="hidden" id="image-preview">
                                    </div>
                                </div>

                                <button type="submit" id="submit-btn" class="btn btn-primary" style="width: 100%;">List Crop for Sale</button>
                                <button type="button" id="cancel-edit-btn" class="btn btn-secondary hidden" style="width: 100%; margin-top: 0.5rem;">Cancel Edit</button>
                            </form>
                        </div>
                    </div>

                    <div class="my-listings-container">
                        <h4>My Live Listings</h4>
                        <div id="my-listings-grid" class="my-listings-grid">
                           </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="ai-modal-overlay" class="modal-overlay"></div>
    <div id="ai-modal" class="modal">
        <div class="modal-header">
            <h4 id="ai-modal-title">AI Assistant</h4>
            <button class="close-btn" data-modal-close>&times;</button>
        </div>
        <div class="modal-body" id="ai-modal-body"></div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            feather.replace();

            const sellerApp = {
                elements: {
                    form: document.getElementById('sell-form'),
                    formTitle: document.getElementById('form-title'),
                    submitBtn: document.getElementById('submit-btn'),
                    cancelBtn: document.getElementById('cancel-edit-btn'),
                    listingIdInput: document.getElementById('listing-id'),
                    listingsGrid: document.getElementById('my-listings-grid'),
                    imageInput: document.getElementById('crop-image'),
                    imagePreviewBox: document.getElementById('image-preview-box'),
                    imagePreview: document.getElementById('image-preview'),
                    imagePrompt: document.getElementById('image-prompt'),
                    aiPriceBtn: document.getElementById('ai-price-btn'),
                    aiModal: document.getElementById('ai-modal'),
                    aiModalOverlay: document.getElementById('ai-modal-overlay'),
                    aiModalTitle: document.getElementById('ai-modal-title'),
                    aiModalBody: document.getElementById('ai-modal-body'),
                },
                state: {
                    listings: [],
                    imageBase64: null,
                },

                init() {
                    this.loadListings();
                    this.renderListings();
                    this.bindEvents();
                },

                bindEvents() {
                    this.elements.form.addEventListener('submit', this.handleSubmit.bind(this));
                    this.elements.cancelBtn.addEventListener('click', () => this.resetForm());
                    this.elements.imagePreviewBox.addEventListener('click', () => this.elements.imageInput.click());
                    this.elements.imageInput.addEventListener('change', this.handleImageUpload.bind(this));
                    this.elements.listingsGrid.addEventListener('click', this.handleListingActions.bind(this));
                    this.elements.aiPriceBtn.addEventListener('click', this.getAiPriceSuggestion.bind(this));
                    this.elements.aiModal.querySelector('[data-modal-close]').addEventListener('click', this.closeAiModal.bind(this));
                },

                loadListings() {
                    this.state.listings = JSON.parse(localStorage.getItem('userCropListings')) || [];
                },

                saveListings() {
                    localStorage.setItem('userCropListings', JSON.stringify(this.state.listings));
                },
                
                renderListings() {
                    this.elements.listingsGrid.innerHTML = '';
                    if (this.state.listings.length === 0) {
                        this.elements.listingsGrid.innerHTML = `<p style="text-align:center; color: var(--light-text);">You have no active listings.</p>`;
                        return;
                    }
                    this.state.listings.forEach(listing => {
                        const card = `
                            <div class="listing-card">
                                <img src="${listing.img}" alt="${listing.name}" class="listing-card-image">
                                <div class="listing-card-info">
                                    <h5>${listing.name}</h5>
                                    <p>₹${listing.price}/qt - ${listing.quantity} qt available</p>
                                </div>
                                <div class="listing-card-actions">
                                    <button class="btn-icon edit-listing" data-id="${listing.id}" title="Edit"><i data-feather="edit-2"></i></button>
                                    <button class="btn-icon delete-listing delete" data-id="${listing.id}" title="Delete"><i data-feather="trash-2"></i></button>
                                </div>
                            </div>`;
                        this.elements.listingsGrid.innerHTML += card;
                    });
                    feather.replace();
                },

               handleSubmit(e) {
    e.preventDefault();
    const id = this.elements.listingIdInput.value;
    const listingData = {
        id: id ? Number(id) : Date.now(),
        name: document.getElementById('crop-name').value,
        category: document.getElementById('crop-category').value,
        price: Number(document.getElementById('price').value),
        quantity: Number(document.getElementById('quantity').value),
        location: document.getElementById('location').value,
        grade: document.getElementById('crop-grade').value, // Added
        type: document.getElementById('produce-type').value,  // Added
        img: this.state.imageBase64,
    };

    if (!listingData.name || !listingData.category || !listingData.price || !listingData.quantity || !listingData.location || !listingData.img) {
        alert('Please fill all required fields and upload an image.');
        return;
    }

    if (id) { // Update
        const index = this.state.listings.findIndex(l => l.id == id);
        this.state.listings[index] = listingData;
        alert('Listing updated successfully!');
    } else { // Create
        this.state.listings.push(listingData);
        alert('Your crop has been listed for sale!');
    }
    this.saveListings();
    this.renderListings();
    this.resetForm();
},
                
                resetForm() {
                    this.elements.form.reset();
                    this.elements.listingIdInput.value = '';
                    this.elements.formTitle.textContent = 'List a New Crop';
                    this.elements.submitBtn.textContent = 'List Crop for Sale';
                    this.elements.cancelBtn.classList.add('hidden');
                    this.elements.imagePreview.classList.add('hidden');
                    this.elements.imagePrompt.classList.remove('hidden');
                    this.state.imageBase64 = null;
                },

                handleImageUpload(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        this.state.imageBase64 = reader.result;
                        this.elements.imagePreview.src = reader.result;
                        this.elements.imagePreview.classList.remove('hidden');
                        this.elements.imagePrompt.classList.add('hidden');
                    };
                    reader.readAsDataURL(file);
                },

                handleListingActions(e) {
                    const button = e.target.closest('button');
                    if (!button) return;
                    const id = button.dataset.id;
                    if (button.classList.contains('edit-listing')) this.editListing(id);
                    if (button.classList.contains('delete-listing')) this.deleteListing(id);
                },

                editListing(id) {
                    const listing = this.state.listings.find(l => l.id == id);
                    if (!listing) return;
                    
                    this.elements.listingIdInput.value = listing.id;
                    document.getElementById('crop-name').value = listing.name;
                    document.getElementById('crop-category').value = listing.category;
                    document.getElementById('price').value = listing.price;
                    document.getElementById('quantity').value = listing.quantity;
                    document.getElementById('location').value = listing.location;

                    this.elements.imagePreview.src = listing.img;
                    this.elements.imagePreview.classList.remove('hidden');
                    this.elements.imagePrompt.classList.add('hidden');
                    this.state.imageBase64 = listing.img;

                    this.elements.formTitle.textContent = 'Edit Your Listing';
                    this.elements.submitBtn.textContent = 'Update Listing';
                    this.elements.cancelBtn.classList.remove('hidden');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                },

                deleteListing(id) {
                    if (confirm('Are you sure you want to delete this listing?')) {
                        this.state.listings = this.state.listings.filter(l => l.id != id);
                        this.saveListings();
                        this.renderListings();
                        alert('Listing deleted.');
                    }
                },
                
                openAiModal(title, content) {
                    this.elements.aiModalTitle.textContent = title;
                    this.elements.aiModalBody.innerHTML = content;
                    this.elements.aiModal.classList.add('active');
                    this.elements.aiModalOverlay.classList.add('active');
                },

                closeAiModal() {
                    this.elements.aiModal.classList.remove('active');
                    this.elements.aiModalOverlay.classList.remove('active');
                },
                
                getAiPriceSuggestion() {
                    const cropName = document.getElementById('crop-name').value;
                    const location = document.getElementById('location').value;

                    if (!cropName || !location) {
                        alert('Please enter a Crop Name and Location first.');
                        return;
                    }
                    
                    this.openAiModal('AI Price Suggester', '<div class="loader-container"><div class="loader"></div></div>');

                    // Simulate API call
                    setTimeout(() => {
                        const basePrice = 2000 + Math.floor(Math.random() * 1500);
                        const suggestedPrice = Math.round(basePrice / 50) * 50; // Round to nearest 50
                        
                        this.elements.aiModalBody.innerHTML = `
                            <p>Based on current market data for <strong>${cropName}</strong> in your area, we suggest a price of:</p>
                            <div class="ai-response"><strong>₹${suggestedPrice}</strong> / quintal</div>
                            <button class="btn btn-primary" id="use-price-btn" style="width:100%; margin-top:1rem;">Use This Price</button>
                        `;
                        document.getElementById('use-price-btn').addEventListener('click', () => {
                            document.getElementById('price').value = suggestedPrice;
                            this.closeAiModal();
                        });
                    }, 1500);
                }
            };

            sellerApp.init();
        });
    </script>
</body>
</html>